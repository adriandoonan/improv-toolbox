---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import FilterDrawer from "../../components/FilterDrawer.astro";
import { getCollection } from "astro:content";
const warmups = (await getCollection("warmups")).sort((a, b) =>
  a.data.name.localeCompare(b.data.name)
);
const names = Array.from(new Set(warmups.map((w) => w.data.name))).sort(
  (a, b) => a.localeCompare(b)
);
const focuses = Array.from(
  new Set(warmups.map((w) => w.data.focus).filter(Boolean))
).sort((a, b) => a.localeCompare(b));
const minPeople = Array.from(
  new Set(warmups.map((w) => w.data.minimumPeople).filter((value) =>
    value != null
  ))
).sort((a, b) => a - b);
---

<BaseLayout>
  <Breadcrumbs items={[{ label: "Warmups" }]} />
  <div style="margin-bottom: 1rem;">
    <FilterDrawer
      fields={[
        { name: "name", label: "Name", type: "select", options: names },
        focuses.length
          ? { name: "focus", label: "Focus", type: "select", options: focuses }
          : null,
        minPeople.length
          ? {
              name: "minimumPeople",
              label: "Minimum People",
              type: "select",
              options: minPeople.map(String),
            }
          : null,
      ].filter(Boolean)}
    />
  </div>
  <ul id="warmupList" class="no-bullets">
    {
      warmups.map((warmup) => (
        <li
          class="no-bullets-li"
          data-name={warmup.data.name}
          data-focus={warmup.data.focus ?? ""}
          data-minimum-people={
            warmup.data.minimumPeople != null
              ? String(warmup.data.minimumPeople)
              : ""
          }
        >
          <article>
            <header>
              <h2 style="margin-bottom:0.5rem;">
                <a href={`/warmups/${warmup.slug}`}>{warmup.data.name}</a>
              </h2>
            </header>
            <p>{warmup.data.shortDescription}</p>
          </article>
        </li>
      ))
    }
  </ul>
  <script>
    const form = document.querySelector(".filter-form");
    const list = document.getElementById("warmupList");
    form &&
      form.addEventListener("change", () => {
        const nameInput = form.querySelector('[name="name"]');
        const focusInput = form.querySelector('[name="focus"]');
        const minPeopleInput = form.querySelector('[name="minimumPeople"]');
        const name = nameInput ? nameInput.value : "";
        const focus = focusInput ? focusInput.value : "";
        const minPeople = minPeopleInput ? minPeopleInput.value : "";
        Array.from(list?.children || []).forEach((li) => {
          const el = li;
          const matchesName = !name || el.dataset.name === name;
          const matchesFocus = !focus || el.dataset.focus === focus;
          const matchesMinPeople =
            !minPeople || el.dataset.minimumPeople === minPeople;
          el.style.display =
            matchesName && matchesFocus && matchesMinPeople ? "" : "none";
        });
      });
  </script>
  <style>
    .no-bullets {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .no-bullets-li {
      list-style: none;
      padding-left: 0;
    }
  </style>
</BaseLayout>
